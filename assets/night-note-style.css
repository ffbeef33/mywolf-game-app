:root {
    --primary-bg: #0d1117;
    --secondary-bg: #161b22;
    --card-bg: #161b22;
    --text-color: #58a6ff;
    --light-text: #c9d1d9;
    --button-bg: #238636;
    --border-color: #30363d;
    --danger-color: #f85149;
    --safe-color: #238636;
    --protect-color: #58a6ff;
    --neutral-color: #d29922;
    --disable-color: #ffd33d;
    --disable-bg: #2b2a1e;
    --alive-glow: #58a6ff;
    --dead-glow: #f85149;
    --disable-glow: #ffd33d;
    --font-main: 'Roboto', 'Segoe UI', 'Arial', sans-serif;
    --font-display: 'Montserrat', 'Segoe UI', 'Arial', sans-serif;
    --border-radius: 12px;
    --special-color: #8257e5; /* Tím Copilot */
    --special-hover-color: #a371f7;
    --cursed-color: #c934e7; /* Màu tím cho Nguyền */

    /* Màu tương tác đêm */
    --status-protected-bg: rgba(88, 166, 255, 0.15);
    --status-saved-bg: rgba(46, 160, 67, 0.15);
    --status-danger-bg: rgba(248, 81, 73, 0.15);
    --status-disabled-bg: rgba(110, 118, 129, 0.2);
    --status-disabled-ability-bg: rgba(210, 153, 34, 0.15);
    --status-cursed-bg: rgba(201, 52, 231, 0.15);
}
body {
    font-family: var(--font-main);
    background-color: var(--primary-bg);
    color: var(--light-text);
    margin: 0;
    padding: 10px;
}
.container {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
}
.card {
    background-color: var(--card-bg);
    padding: 20px;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
}
.main-header { text-align: center; margin-bottom: 20px; }
.main-header h1 { font-family: var(--font-display); font-size: 2rem; color: var(--text-color); margin: 0; }
.main-header p { font-size: 1.1rem; opacity: 0.8; }

.results-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    align-items: start;
}

.results-info {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#night-results {
    background-color: var(--primary-bg);
    padding: 15px;
    border-radius: 8px;
    min-height: 50px;
    font-size: 1.1rem;
    font-weight: 500;
    margin: 0;
}

#night-results .dead-player { 
    color: var(--danger-color); 
    font-weight: 700; 
}

#gm-night-note {
    width: 100%;
    padding: 10px 12px;
    background: var(--primary-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    color: var(--light-text);
    resize: vertical;
    margin: 0;
}

.result-buttons { 
    display: flex; 
    flex-direction: column; 
    gap: 10px; 
}

.result-buttons button {
    width: 100%;
}

@media (max-width: 600px) {
    .results-grid {
        grid-template-columns: 1fr;
    }
}

button {
    padding: 10px 15px; border: none; border-radius: 8px;
    background-color: var(--button-bg); color: white;
    font-size: 1rem; font-weight: 700; cursor: pointer;
    transition: filter 0.2s, background-color 0.2s;
    white-space: nowrap;
}
button:hover { filter: brightness(1.1); }
button.btn-primary { background-color: var(--text-color); color: var(--primary-bg); }
button.btn-primary:hover { background-color: #8ab9ff; }
button.btn-special { background-color: var(--special-color); }
button.btn-special:hover:not(:disabled) { background-color: var(--special-hover-color); }
.btn-end-night { background-color: var(--protect-color); }
#reset-night-btn { background-color: #484f58; }
.btn-danger {
    background-color: var(--danger-color) !important;
    color: #fff !important;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
}
.btn-danger:hover {
    background-color: #c73c3c !important;
}

.faction-group-wrapper {
    background-color: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: 24px;
    padding: 0;
    overflow: hidden; 
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
.faction-group-wrapper.faction-wolf { border-color: var(--danger-color); }
.faction-group-wrapper.faction-villager { border-color: var(--safe-color); }
.faction-group-wrapper.faction-neutral { border-color: var(--neutral-color); }

.faction-header {
    width: 100%;
    padding: 8px 10px;
    margin-top: 0;
    background-color: var(--card-bg);
    border-bottom: 2px solid var(--border-color);
    font-family: var(--font-display);
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--light-text);
}
.faction-header.faction-wolf { color: var(--danger-color); border-bottom-color: var(--danger-color); }

.player-row {
    padding: 12px 10px; 
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.3s;
}

.faction-group-wrapper .player-row:last-child {
    border-bottom: none;
}

.player-header {
    display: flex;
    justify-content: space-between;
    align-items: center; 
    width: 100%;
    gap: 10px;
}

.player-info {
    flex-grow: 1; 
    min-width: 0;
}

.player-info .player-name-wrapper,
.player-info .player-role {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; 
}

.player-info .player-name { 
    font-size: 1.2rem; 
    font-weight: 700; 
    color: var(--light-text); 
}
.player-info .player-role { 
    font-size: 0.9rem; 
    opacity: 0.7; 
}

.action-display-list {
    margin-top: 8px;
    padding-left: 15px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.action-display-item {
    font-size: 0.9rem;
    color: var(--light-text);
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.action-display-item strong {
    color: var(--neutral-color);
    font-weight: 600;
}
.remove-action-btn {
    background-color: var(--danger-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 12px;
    line-height: 18px;
    padding: 0;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
    flex-shrink: 0;
}
.action-display-item:hover .remove-action-btn {
    opacity: 1;
}

.player-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

.action-modal-btn {
    padding: 6px 12px;
    font-size: 0.9rem;
}

.action-modal-btn.wolf-bite-btn {
    background-color: var(--danger-color);
}
.action-modal-btn.wolf-bite-btn:hover {
    background-color: #c73c3c;
}
.action-modal-btn.wolf-curse-btn {
    background-color: var(--cursed-color);
}
.action-modal-btn.wolf-curse-btn:hover {
    filter: brightness(1.2);
}


.player-status-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    border: 2px solid;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
}
.player-status-icon:hover {
    transform: scale(1.1);
}
.player-status-icon.alive {
    color: var(--safe-color);
    border-color: var(--safe-color);
}
.player-status-icon.dead {
    color: var(--danger-color);
    border-color: var(--danger-color);
}

.player-row.status-dead { opacity: 0.5; background-color: #111; }
.player-row.status-dead .action-modal-btn { display: none; }
.player-row.status-protected { background-color: var(--status-protected-bg); }
.player-row.status-saved { background-color: var(--status-saved-bg); }
.player-row.status-danger { background-color: var(--status-danger-bg); }
.player-row.status-disabled { background-color: var(--status-disabled-bg); }
.player-row.status-disabled-by-ability { background-color: var(--status-disabled-ability-bg); }
.player-row.status-cursed { background-color: var(--status-cursed-bg); border-left: 3px solid var(--cursed-color); }
.cursed-note { color: var(--cursed-color); font-weight: 700; font-style: italic;}


.player-row.status-permanently-disabled {
    background-image: repeating-linear-gradient(
        -45deg,
        var(--status-disabled-bg),
        var(--status-disabled-bg) 10px,
        rgba(0, 0, 0, 0.1) 10px,
        rgba(0, 0, 0, 0.1) 20px
    );
}

.player-row.status-permanently-disabled .player-name {
    color: var(--disable-color);
    text-decoration: line-through;
}

.status-icons {
    display: flex;
    gap: 10px;
    font-size: 1rem;
    align-items: center;
    margin-right: 10px;
}
.icon-protected { color: var(--protect-color); }
.icon-saved { color: var(--safe-color); }
.icon-danger { color: var(--danger-color); }
.icon-disabled-by-ability { color: var(--disable-color); }
.status-icons .icon-armor { color: var(--neutral-color); opacity: 0.8; }
.icon-notified { color: var(--disable-color); }

.night-tabs-container {
    padding: 15px;
    border-radius: var(--border-radius); margin-bottom: 20px;
    border: 1px solid var(--border-color); display: flex;
    align-items: center; gap: 10px; flex-wrap: wrap;
}
#night-tabs { display: flex; gap: 10px; flex-wrap: wrap; }
.night-tab {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
}
.night-tab.active { background-color: var(--text-color); border-color: var(--text-color); color: #fff; }

.loading-spinner {
    width: 40px; height: 40px; border: 4px solid #444;
    border-top-color: var(--text-color); border-radius: 50%;
    animation: spin 1s linear infinite; margin: 20px auto;
}
@keyframes spin { to { transform: rotate(360deg); } }

.modal-overlay {
    position: fixed;
    z-index: 1000;
    left: 0; top: 0; width: 100%; height: 100%;
    background-color: rgba(13, 17, 23, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s;
}
.modal-overlay.hidden { display: none; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.modal-content {
    background-color: var(--card-bg);
    padding: 25px;
    border: 1px solid var(--border-color);
    width: 90%;
    border-radius: var(--border-radius);
    position: relative;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
}
.close-modal-btn {
    color: var(--light-text);
    position: absolute; top: 10px; right: 20px;
    font-size: 28px; font-weight: bold; cursor: pointer;
}

.modal-content.action-modal { max-width: 600px; background-color: #111; }
#action-modal-title {
    margin-top: 0;
    color: var(--special-color);
    font-family: var(--font-display);
    text-align: center;
    font-size: 2rem;
}
.action-modal-section { margin-bottom: 25px; }
.action-modal-section h4 {
    margin: 0 0 15px 0;
    font-family: var(--font-display);
    color: var(--light-text);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
}

.target-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
}
.target-item {
    display: flex;
    align-items: center;
    background-color: var(--secondary-bg);
    padding: 8px;
    border-radius: 6px;
}
.target-item input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
.target-item label { font-size: 1rem; }

.gm-override-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 10px;
}
.gm-override-grid button {
    padding: 10px;
    font-size: 0.9rem;
    border: 1px solid var(--border-color);
    color: #fff;
    font-weight: 600;
}
.gm-override-grid button:hover {
    border-color: #fff;
    filter: brightness(1.2);
}
.gm-override-grid button[data-override="gm_kill"] { background-color: #a62626; border-color: #f85149; }
.gm-override-grid button[data-override="gm_save"] { background-color: #1a632f; border-color: #2ea043; }
.gm-override-grid button[data-override="gm_protect"] { background-color: #1a4c8a; border-color: #58a6ff; }
.gm-override-grid button[data-override="gm_add_armor"] { background-color: #8a8a1c; border-color: #d29922; }
.gm-override-grid button[data-override="gm_disable_night"],
.gm-override-grid button[data-override="gm_disable_perm"] { background-color: #8a8a1c; border-color: #d29922; }
.gm-override-grid button[data-override="change_faction"] { background-color: #8a4a1c; border-color: #ffa500; }


.modal-buttons { margin-top: 20px; text-align: right; }

.modal-content.faction-change-modal {
    max-width: 400px;
}
#faction-change-title {
    margin-top: 0;
    text-align: center;
    color: var(--light-text);
}
.faction-change-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 20px;
}
.faction-change-options button {
    width: 100%;
}
.faction-change-options button[data-faction="Bầy Sói"] { background-color: var(--danger-color); }
.faction-change-options button[data-faction="Phe Sói"] { background-color: var(--danger-color); opacity: 0.8; }
.faction-change-options button[data-faction="Phe Dân"] { background-color: var(--safe-color); }


#voting-section {
    border: 1px solid var(--special-color);
    margin-top: 30px;
}
#voting-section h2 {
    color: var(--special-color);
    margin-top: 0;
    border-bottom: 1px solid var(--special-color);
    padding-bottom: 10px;
    margin-bottom: 15px;
}
#voting-section h2 .fa-gavel { margin-right: 10px; }
.voting-controls {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}
.voting-controls input[type="text"],
.voting-controls input[type="number"] {
    padding: 10px;
    background-color: var(--primary-bg);
    border: 1px solid var(--border-color);
    color: var(--light-text);
    border-radius: 8px;
    font-size: 1rem;
}
#vote-players-list { margin-bottom: 20px; }
#vote-players-list h4 {
    margin-top: 0;
    color: var(--light-text);
    font-weight: 500;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
}
.vote-player-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border-radius: 6px;
    transition: background-color: 0.2s;
}
.vote-player-row:nth-child(even) { background-color: var(--primary-bg); }
.vote-player-row .vote-player-name { font-weight: 600; }

#vote-results-container {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
#vote-results-container h3 { grid-column: 1 / -1; margin-top: 0; }
#vote-results-container h4 { color: var(--light-text); margin: 0 0 10px 0; }
#vote-results-container ul { list-style-type: none; padding: 0; margin: 0; }
#vote-results-container li { margin-bottom: 5px; padding: 4px; border-radius: 4px; }
#vote-results-summary .most-voted {
    color: var(--danger-color);
    font-weight: bold;
    background-color: rgba(248, 81, 73, 0.15);
}

.vote-weight-controls { display: flex; align-items: center; gap: 8px; }
.vote-weight-display {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--light-text);
    min-width: 20px;
    text-align: center;
}
.weight-btn {
    width: 28px; height: 28px; border-radius: 50%;
    border: 1px solid var(--border-color);
    background-color: var(--secondary-bg);
    color: var(--light-text);
    font-size: 1.2rem; font-weight: bold;
    line-height: 26px; padding: 0; cursor: pointer;
    transition: all 0.2s;
}
.weight-btn:hover { background-color: var(--border-color); border-color: var(--text-color); }
.weight-btn.plus:hover { color: var(--safe-color); border-color: var(--safe-color); }
.weight-btn.minus:hover { color: var(--danger-color); border-color: var(--danger-color); }

.gm-timer-display {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color);
    margin-left: 15px;
    display: none; 
}

.player-name-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
}

.player-group-tag {
    background-color: var(--neutral-color);
    color: var(--primary-bg);
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 700;
}

.action-modal-btn.group-btn {
    background-color: var(--neutral-color);
    opacity: 0.8;
}

.action-modal-btn.group-btn:hover {
    background-color: var(--neutral-color);
    opacity: 1;
}

.form-control {
    width: 100%;
    padding: 10px;
    background-color: var(--primary-bg);
    border: 1px solid var(--border-color);
    color: var(--light-text);
    border-radius: 8px;
    font-size: 1rem;
    margin-bottom: 15px;
}

#night-logs-section h2 {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}
#night-logs-section h4 {
    font-family: var(--font-display);
    color: var(--light-text);
    font-size: 1.1rem;
    margin: 15px 0 10px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}
#gm-log-container h4 { color: var(--neutral-color); }
#player-log-container h4 { color: var(--protect-color); }

.log-content {
    background-color: var(--primary-bg);
    border-radius: 8px;
    padding: 15px;
    min-height: 50px;
}

.log-item {
    padding: 4px 0;
    font-size: 0.95rem;
}

.log-item strong {
    font-weight: 600;
}

.log-item .player-name {
    color: var(--light-text);
    font-weight: 700;
}

.log-item .role-name {
    color: var(--text-color);
    font-style: italic;
    opacity: 0.8;
}
.log-item .faction-name {
     color: var(--neutral-color);
}

.log-item.player-action .target-name {
    color: var(--neutral-color);
}
.log-item.gm-action {
     color: #e3b341;
}
.log-item.info-result {
     color: #6a9ce2;
     font-style: italic;
}
.log-placeholder {
    color: var(--light-text);
    opacity: 0.5;
    font-style: italic;
}

#action-modal-choices {
    justify-content: center;
}

#action-modal-choices button {
    background-color: #30363d;
    border: 1px solid #484f58;
    transition: all 0.2s ease;
}

#action-modal-choices button:hover {
    filter: brightness(1.2);
}

#action-modal-choices button.selected {
    border-color: var(--special-color);
    background-color: var(--special-color);
    color: white;
    transform: scale(1.05);
    box-shadow: 0 0 10px var(--special-color);
}

#action-modal-choices button.action-type-damage { background-color: #a62626; border-color: #f85149; }
#action-modal-choices button.action-type-defense { background-color: #1a632f; border-color: #2ea043; }
#action-modal-choices button.action-type-info { background-color: #1a4c8a; border-color: #58a6ff; }
#action-modal-choices button.action-type-debuff { background-color: #8a8a1c; border-color: #d29922; }
#action-modal-choices button.action-type-buff { background-color: var(--special-color); border-color: var(--special-hover-color); }
#action-modal-choices button.action-type-conditional { background-color: #8a4a1c; border-color: #ffa500; }

#action-modal-choices button:disabled {
    background-color: var(--secondary-bg);
    border-color: var(--border-color);
    opacity: 0.5;
    cursor: not-allowed;
    text-decoration: line-through;
    transform: scale(1);
    box-shadow: none;
}
#action-modal-choices button:disabled:hover {
    filter: none;
}
.target-item input[type="checkbox"]:disabled + label {
    opacity: 0.5;
    cursor: not-allowed;
    text-decoration: line-through;
}

/* --- TÍNH NĂNG MỚI: GIAO DIỆN DI CHÚC (QUẢN TRÒ) --- */
.will-modal-btn {
    padding: 6px 12px;
    font-size: 0.9rem;
    background-color: #484f58; /* Màu xám */
    opacity: 0.9;
}
.will-modal-btn:hover {
    opacity: 1;
    filter: brightness(1.1);
}

.will-content-display {
    background-color: var(--primary-bg);
    padding: 15px;
    border-radius: 8px;
    white-space: pre-wrap; /* Giữ lại các khoảng trắng và xuống dòng */
    line-height: 1.6;
    max-height: 60vh;
    overflow-y: auto;
    border: 1px solid var(--border-color);
}

/* --- Chế độ Tương tác Override --- */
#mode-override-container {
    margin-top: 15px;
    padding: 10px;
    background-color: var(--primary-bg);
    border-radius: 8px;
    border: 1px solid var(--border-color);
    text-align: center;
}

#mode-status-indicator {
    font-weight: 700;
    margin-right: 15px;
}

#force-manual-mode-btn {
    padding: 8px 12px;
    font-size: 0.9rem;
}